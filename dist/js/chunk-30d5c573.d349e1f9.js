(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-30d5c573"],{"029e":function(e,t,a){"use strict";var i=a("c50a"),o=a.n(i);o.a},"1b87":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page-lesson-list"},[a("header",[a("div"),a("el-button",{attrs:{type:"primary",icon:"el-icon-plus",size:"medium"},on:{click:e.gotoAdd}},[e._v("新增")])],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.data}},[a("el-table-column",{attrs:{type:"index","label-class-name":"index-col","class-name":"index-col",label:"序号",width:"70"}}),a("el-table-column",{attrs:{width:"150",label:"轮播图片"},scopedSlots:e._u([{key:"default",fn:function(e){return[a("img",{attrs:{src:e.row.img_media_url,width:"100",height:"100",alt:""}})]}}])}),a("el-table-column",{attrs:{prop:"course_name","min-width":"200",label:"所属课程"}}),a("el-table-column",{attrs:{prop:"category_name",label:"所属分类"}}),a("el-table-column",{attrs:{label:"操作","min-width":"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.gotoEdit(t.row)}}},[e._v("编辑")]),a("el-button",{staticClass:"delete",attrs:{type:"text"},on:{click:function(a){return e.deleteLesson(t.row.id)}}},[e._v("删除")])]}}])})],1),a("page-pagination",{attrs:{total:e.total},on:{currentChange:e.handleCurrentChange}}),a("el-dialog",{attrs:{title:e.id?"编辑轮播":"新建轮播",width:"700px",visible:e.showDialog},on:{close:e.resetForm,"update:visible":function(t){e.showDialog=t}}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingDetail,expression:"loadingDetail"}],staticClass:"lesson-form"},[a("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-position":"left","label-width":"100px"}},[a("el-form-item",{attrs:{label:"所属课程",prop:"course_id"}},[a("el-select",{attrs:{placeholder:"请选择课程分类"},model:{value:e.form.course_id,callback:function(t){e.$set(e.form,"course_id",t)},expression:"form.course_id"}},e._l(e.options,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1),a("el-form-item",{attrs:{label:"轮播图",prop:"img_media_id"}},[a("img-loader",{attrs:{action:e.action,data:e.imgData,"before-upload":e.beforeUpload},on:{success:e.onUploadSuccess,error:e.onUploadError},model:{value:e.form.img_url,callback:function(t){e.$set(e.form,"img_url",t)},expression:"form.img_url"}})],1)],1),a("div",{staticClass:"submit-btn"},[a("el-button",{attrs:{type:"primary",loading:e.btnloading,size:"medium"},on:{click:e.save}},[e._v("保存")])],1)],1)])],1)},o=[],n=a("cebc"),s=a("2934"),r=a("a9bf"),c=a("c9c8");function l(e){return r["a"].get(Object(c["a"])("/carouse"),{params:e})}function u(e){return r["a"].get(Object(c["a"])("/carouse/".concat(e)))}function d(e){return r["a"].delete(Object(c["a"])("/carouse/".concat(e)))}function f(e){return r["a"].post(Object(c["a"])("/carouse"),e)}function m(e,t){return r["a"].put(Object(c["a"])("/carouse/".concat(e)),t)}var g={img_media_id:"",img_url:"",course_id:""},h={data:function(){return{action:s["b"],data:[],loading:!1,total:0,key:"",showDialog:!1,imgData:{media_type:1},id:"",form:Object(n["a"])({},g),rules:{course_id:{message:"请至少选择一个课程分类",required:!0,trigger:["blur"]},img_media_id:{message:"轮播图片不能为空",required:!0,trigger:["blur","change"]}},options:[{categoryId:1,categoryName:""}],loadingDetail:!1,btnloading:!1,page:1}},components:{},methods:{refreshData:function(){this.fetchData(),this.showDialog=!1},gotoAdd:function(){this.showDialog=!0,this.id="",this.resetForm()},handleCurrentChange:function(e){this.page=e,this.fetchData(e)},fetchData:function(e){var t=this;this.loading||(this.loading=!0,l({page:e||this.page||1}).then(function(e){t.data=e.data,t.total=e.total}).catch(function(e){t.$message.error(e.message)}).finally(function(){t.loading=!1}))},deleteLesson:function(e){var t=this;this.$confirm("此操作将永久删除该轮播图片, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){d(e).then(function(){if(t.$message.success("删除轮播成功"),1===t.data.length){var e=t.page-1;t.page=e>=1?e:1}t.fetchData()}).catch(function(e){t.$message.error(e.message)})}).catch(function(){t.$message({type:"info",message:"已取消删除"})})},gotoEdit:function(e){this.showDialog=!0,this.id=e.id,this.fetchDetail()},beforeUpload:function(){},onUploadSuccess:function(e){200===e.code?(this.form.img_url=e.data.media_real_url,this.form.img_media_id=e.data.media_id,this.$message.success("上传图片成功")):this.$message.error("图片上传失败：".concat(e.msg))},onUploadError:function(){this.$message.error("图片上传失败")},save:function(){var e=this;this.$refs.form.validate(function(t){if(t){if(e.btnloading)return;e.btnloading=!0,e.id?m(e.$route.params.id,e.form).then(function(){e.$message.success("编辑成功"),e.fetchData(),e.showDialog=!1}).catch(function(t){e.$message.error(t.message)}).finally(function(){e.btnloading=!1}):f(Object(n["a"])({},e.form)).then(function(){e.$message.success("添加成功"),e.fetchData(),e.showDialog=!1}).catch(function(t){e.$message.error(t.message)}).finally(function(){e.btnloading=!1})}})},fetchDetail:function(){var e=this;this.loadingDetail||(this.loadingDetail=!0,u(this.id).then(function(t){e.form=Object(n["a"])({},t),e.$refs.form.clearValidate()}).catch(function(t){e.$message.error(t.message)}).finally(function(){e.loadingDetail=!1}))},resetForm:function(){this.$refs.form&&this.$refs.form.resetFields(),this.form=Object(n["a"])({},g)}},created:function(){var e=this;this.fetchData(),Object(s["a"])().then(function(t){e.options=t}).catch(function(t){e.$message.error(t.message)})}},p=h,b=(a("029e"),a("2877")),_=Object(b["a"])(p,i,o,!1,null,"0ce3173e",null);t["default"]=_.exports},2934:function(e,t,a){"use strict";a.d(t,"b",function(){return r}),a.d(t,"a",function(){return c});var i=a("a9bf"),o=a("c9c8"),n=a("52f9"),s=Object(n["a"])(),r=Object(o["a"])("".concat(s,"/college/upload"));function c(){return i["a"].get(Object(o["a"])("/lesson/all"))}},c50a:function(e,t,a){}}]);
//# sourceMappingURL=chunk-30d5c573.d349e1f9.js.map